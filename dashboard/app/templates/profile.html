{% extends "base.html" %}
{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-12">
            <h3 class="fw-bold">–ü—Ä–æ—Ñ–∏–ª—å</h3>
            <p class="text-muted">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ –ø–æ–¥–ø–∏—Å–∫–æ–π</p>
        </div>
    </div>

    <ul class="nav nav-pills mb-4 bg-light p-2 rounded shadow-sm" id="profileTabs" role="tablist" style="max-width: fit-content;">
        <li class="nav-item">
            <a class="nav-link active" id="info-tab" data-toggle="pill" href="#info" role="tab">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="plan-tab" data-toggle="pill" href="#plan" role="tab">üìã –¢–∞—Ä–∏—Ñ</a>
        </li>
        <li class="nav-item">
            <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">$ –ü–ª–∞—Ç–µ–∂–∏</a>
        </li>
    </ul>

    {% if form.errors %}
    <div class="alert alert-danger shadow-sm">
        <strong>–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:</strong> –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
        {{ form.non_field_errors }}
    </div>
    {% endif %}

    <div class="tab-content" id="profileTabsContent">
        <div class="tab-pane fade show active" id="info" role="tabpanel">
            <div class="card shadow-sm border-0 p-4 rounded-4">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-3 text-center border-right">
                            <div class="mb-3 position-relative d-inline-block">
                                {% if user.userprofile.avatar %}
                                    <img src="{{ user.userprofile.avatar.url }}" class="rounded-circle shadow-sm border" style="width: 140px; height: 140px; object-fit: cover;">
                                {% else %}
                                    <div class="bg-white rounded-circle d-flex align-items-center justify-content-center shadow-sm border" style="width: 140px; height: 140px;">
                                        <span class="h1 mb-0 text-primary fw-bold">{{ user.username|slice:":2"|upper }}</span>
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="mt-2">
                                <label for="id_avatar" class="btn btn-sm btn-outline-primary px-3">–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ</label>
                                <div class="d-none">
                                    {{ form.avatar }}
                                </div>
                                <small class="text-muted d-block mt-2">JPG, PNG –¥–æ 1–ú–ë</small>
                            </div>
                        </div>

                        <div class="col-md-9">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="small fw-bold text-uppercase text-muted">–ò–º—è</label>
                                    {{ form.full_name }}
                                    <div class="text-danger small">{{ form.full_name.errors }}</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="small fw-bold text-uppercase text-muted">Email</label>
                                    {{ form.email }}
                                    <div class="text-danger small">{{ form.email.errors }}</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="small fw-bold text-uppercase text-muted">–ö–æ–º–ø–∞–Ω–∏—è</label>
                                    {{ form.company_name }}
                                    <div class="text-danger small">{{ form.company_name.errors }}</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="small fw-bold text-uppercase text-muted">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                    {{ form.phone }}
                                    <div class="text-danger small">{{ form.phone.errors }}</div>
                                </div>
                                <div class="col-md-12 mb-3">
                                    <label class="small fw-bold text-uppercase text-muted">–û —Å–µ–±–µ</label>
                                    {{ form.about }}
                                    <div class="text-danger small">{{ form.about.errors }}</div>
                                </div>
                            </div>
                            <div class="mt-4">
                                <button type="submit" class="btn btn-dark px-5 py-2 fw-bold shadow-sm">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="tab-pane fade" id="plan" role="tabpanel">
            <div class="card shadow-sm border-0 p-4 rounded-4">
                <h5 class="fw-bold mb-4">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–µ</h5>
                <div class="p-4 rounded-4 border" style="background: linear-gradient(45deg, #f8f9fa, #ffffff); border-left: 5px solid #ff9800 !important;">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <span class="badge bg-success px-3 py-2 mb-3 shadow-sm">–ê–∫—Ç–∏–≤–µ–Ω</span>
                            <h2 class="fw-bold mb-1">{{ user.userprofile.subscription_plan|default:"Free" }}</h2>
                            <p class="text-muted mb-0">
                                {% if user.userprofile.subscription_end_date %}
                                    –í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: <strong class="text-dark">{{ user.userprofile.subscription_end_date|date:"d E Y" }}</strong>
                                {% else %}
                                    –¢–∏–ø –∞–∫–∫–∞—É–Ω—Ç–∞: <strong class="text-dark">–ë–µ—Å—Å—Ä–æ—á–Ω—ã–π –¥–æ—Å—Ç—É–ø</strong>
                                {% endif %}
                            </p>
                        </div>
                        <div class="col-md-4 text-md-end mt-3 mt-md-0">
                            <a href="/#pricing" class="btn btn-warning fw-bold px-4 shadow-sm">–£–ª—É—á—à–∏—Ç—å —Ç–∞—Ä–∏—Ñ</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
    .nav-pills .nav-link { color: #6c757d; border-radius: 8px; padding: 10px 24px; font-weight: 500; transition: 0.2s; }
    .nav-pills .nav-link.active { background-color: #fff !important; color: #0d6efd !important; box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
    .nav-link.disabled { opacity: 0.5; }

    /* –§–æ—Ä–º—ã */
    .form-control { 
        background-color: #fcfcfc !important; 
        border: 1px solid #dee2e6 !important; 
        border-radius: 10px !important;
        padding: 10px 15px !important;
        transition: 0.2s;
    }
    .form-control:focus { 
        background-color: #fff !important;
        border-color: #0d6efd !important; 
        box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.1) !important; 
    }
    
    .border-right { border-right: 1px solid #f0f0f0; }
    @media (max-width: 768px) { .border-right { border-right: none; border-bottom: 1px solid #f0f0f0; padding-bottom: 20px; margin-bottom: 20px; } }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
        var activeTab = localStorage.getItem('activeTab');
        if(activeTab){
            var tabEl = document.querySelector('a[href="' + activeTab + '"]');
            if (tabEl) {
                // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–∞–Ω–∏–ª—å–Ω–æ–≥–æ JS –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤–∫–ª–∞–¥–∫–∏ (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Bootstrap 4/5)
                var tab = new bootstrap.Tab(tabEl);
                tab.show();
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
        var tabLinks = document.querySelectorAll('a[data-toggle="pill"]');
        tabLinks.forEach(function(link) {
            link.addEventListener('shown.bs.tab', function (e) {
                localStorage.setItem('activeTab', e.target.getAttribute('href'));
            });
        });
    });
</script>
{% endblock %}